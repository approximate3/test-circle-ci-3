version: 2.1

orbs:
  lighthouse-check: foo-software/lighthouse-check@0.0.8
  
jobs:
  docs:
    working_directory: /tmp
    steps:
      - run:
          name: Creating Dummy Artifacts
          command: |
            echo "my artifact file" > /tmp/art-1;
            mkdir /tmp/artifacts;
            echo "my artifact files in a dir" > /tmp/artifacts/art-2;
      - store_artifacts:
          path: /tmp/art-1
          destination: artifact-file
      - store_artifacts:
          path: /tmp/artifacts

  git:
    docker:
      - image: timbru31/node-alpine-git
    steps:
      - checkout
      - run: git status
      - run: circleci step halt
      - run: exit 1
      
  mocha:
    docker:
      - image: ianwalter/puppeteer:latest
    steps:
      - checkout
      - run: npm install
      - run: npx wdio
      
  lighthouse: 
    executor: lighthouse-check/default
    steps:
      - lighthouse-check/audit:
          urls: https://www.foo.software

workflows:
  version: 2.1
  build:
    jobs:
      - git
      - mocha
      - lighthouse
      -  docs
